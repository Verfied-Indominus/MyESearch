{% extends "layout.html" %}
{% block title %}MyeSearch Results{% endblock %}
{% block page %}MyeSearch Results{% endblock %}

{{ super() }}

{% block content %}
{% autoescape off %}

    {% if search %}
        <div style="min-height: 30vh;" class="uk-background-muted uk-padding">
            <h3 class="uk-margin-small-bottom uk-text-bold">Search Results For "{{search_terms}}"</h3>

            {% if not results[0] and not results[1] and not results[2] %}
                No Results Found
            {% endif %}

            <!-- topics -->
            {% if results[2] %}
                <h4 class="uk-margin-small-bottom">Topics</h4>
                <hr>
                <div style="overflow-x: scroll; white-space: nowrap;" class="uk-flex">
                    {% for top in results[2] %}
                        <a href="" style="padding: 0 10px;" class="uk-text-capitalize uk-margin-small-right uk-button uk-button-default uk-background-default uk-border-pill"> {{top.name}} </a>
                    {% endfor %}
                </div>  
            {% endif %}
            
            <!-- authors -->
            {% if results[0] %}
                <h4 class="uk-margin-small-bottom">Researchers</h4>
                <hr>
                <ul class="uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-4 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                    {% for re in results[0] %}
                        <li onclick="addSearchResearcher({{re.id}});" data-name="{{re.first_name[0]|capitalize}}" data-faculty="{{re.faculty}}" data-department="{{re.department}}" style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                            <div style="cursor: pointer;" onclick="window.location='/profile/{{re.id}}'" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                <div class="uk-margin-small-top uk-margin-small-bottom uk-width-1-1 uk-text-center">
                                    <div class="uk-flex uk-flex-center uk-margin-small-bottom">
                                        <div class="uk-border-circle uk-background-cover" data-src="{% if re.image_url %} {{re.image_url}} {% else %} /static/images/unknown.png {% endif %}" alt="" style="width: 200px; height: 200px;" uk-img></div>
                                    </div>
                                    <h4 class="uk-margin-auto"> {{re.title}} {{re.first_name}} {{re.last_name}} </h4>
                                    <div> {{re.position}} </div>
                                    <div> {{re.faculty}} </div>
                                    <div> {{re.department}} </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            <!-- publications -->
            {% if results[1] %}
                <h4 class="uk-margin-small-bottom">Publications</h4>
                <hr>
                <ul class="uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-2 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                    {% for pub in results[1] %}
                        <li onclick="addSearchPublication({{pub.id}});" data-year="{{pub['publication_date'].strftime('%Y')}}" data-type="{{pub['pub_type']}}" data-name="{{pub['title'][0]|capitalize}}" style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                            <div style="cursor: pointer;" onclick="window.location=`/publication/{{pub['id']}}`" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                <div style="height: 140px; width: 100px;" class="uk-background-contain" data-src="{% if not pub['cover'] %} /static/images/publications/{{pub['pub_type']}}.png {% else %} {{pub['cover']}} {% endif %}" uk-img></div>
                                <div class="uk-margin-small-left uk-width-expand">
                                    <h4 class="uk-margin-remove"> {{pub['title']|title}} </h4>
                                    <div class="uk-text-middle uk-margin-small-bottom"><span class="uk-label"> {{pub['pub_type']}} </span> {% if pub['publication_date'].strftime('%Y') != '1' %} {{pub['publication_date'].strftime('%Y')}} {% endif %} </div>
                                    <div>
                                        {% if pub['pub_records'].all()|length < 3 %}
                                            {% for n in range(pub['pub_records'].all()|length) %}
                                                <a href="/profile/{{pub['pub_records'][n].researcher.id}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('{% if pub['pub_records'][n].researcher.image_url %} {{pub['pub_records'][n].researcher.image_url}} {% else %} /static/images/unknown.png {% endif %} ');" uk-icon></span> {{pub['pub_records'][n].researcher.first_name}}  {{pub['pub_records'][n].researcher.last_name}} </a>                              
                                            {% endfor %}

                                            {% if pub['coauthors'] != "" and pub['coauthors'] %}
                                                {% set coauthors = pub['coauthors'].split(', ') %}
                                            {% endif %}

                                            {% set limit = 3 - pub['pub_records'].all()|length %}
                                            {% if limit < coauthors|length %}
                                                {% for n in range(limit) %}
                                                    <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                                {% endfor %}
                                                {% if coauthors|length - limit > 0 %} +{{coauthors|length - limit}} More {% endif %}
                                            {% else %}    
                                                {% for n in range(coauthors|length) %}
                                                    <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                                {% endfor %}                              
                                            {% endif %}
                                        {% else %}
                                            {% for n in range(3) %}
                                                <a href="/profile/{{pub['pub_records'][n].researcher.id}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url(`{% if pub['pub_records'][n].researcher.image_url %} {{pub['pub_records'][n].researcher.image_url}} {% else %} /static/images/unknown.png {% endif %} `);" uk-icon></span> {{pub['pub_records'][n].researcher.first_name}}  {{pub['pub_records'][n].researcher.last_name}} </a>                              
                                            {% endfor %}
                                            {% if pub['pub_records'].all()|length > 3 %} +{{test|length - 3}} More {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    {% endif %}

    {% if researchers %}
        <div class="uk-background-muted uk-width-1-1" uk-filter="target: .js-filter;">
            <h3 class="uk-text-bold uk-padding uk-padding-remove-bottom">All Researchers ({{researchers|length}} Present) </h3>

            
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Faculty</h4>
                <div>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li onclick="get_selection(this)" class="uk-active" uk-filter-control><a href="#">All</a></li>
                        {% for faculty in faculties %}
                            <li onclick="get_selection(this)" uk-filter-control="filter: [data-faculty='{{faculty}}']; group: data-faculty"><a href="#"> {{faculty}} </a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div style="display: none;" id="department_section" class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Department</h4>
                <div>
                    <ul id="department_listing" class="uk-subnav uk-subnav-pill" uk-margin></ul>
                </div>
            </div>
        
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Alphabetically</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li onclick="get_selection(this)" class="uk-active" uk-filter-control><a href="#">All</a></li>
                        {% for char in "ABCDEFGHIJKLMNOPQRSTUVWXYZ"|list %}
                            <li class="uk-padding-remove uk-margin-small-left" uk-filter-control="filter: [data-name='{{char}}']; group: data-name"><a href="#"> {{char}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            
            <ul class="js-filter uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-4 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                {% for re in researchers %}
                    <li data-name="{{re.first_name[0]|capitalize}}" data-faculty="{{re.faculty}}" data-department="{{re.department}}" style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                        <div style="cursor: pointer;" onclick="window.location='/profile/{{re.id}}'" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                            <div class="uk-margin-small-top uk-margin-small-bottom uk-width-1-1 uk-text-center">
                                <div class="uk-flex uk-flex-center uk-margin-small-bottom">
                                    <div class="uk-border-circle uk-background-cover" data-src="{% if re.image_url %} {{re.image_url}} {% else %} /static/images/unknown.png {% endif %}" alt="" style="width: 200px; height: 200px;" uk-img></div>
                                </div>
                                <h4 class="uk-margin-auto"> {{re.title}} {{re.first_name}} {{re.last_name}} </h4>
                                <div> {{re.position}} </div>
                                <div> {{re.faculty}} </div>
                                <div> {{re.department}} </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

    {% if publications %}
        <div class="uk-background-muted uk-width-1-1" uk-filter="target: .js-filter;">
            <h3 class="uk-text-bold uk-padding uk-padding-remove-bottom">All Publications ({{publications|length}} Present) </h3>

            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column">Publication Type</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li class="uk-active" uk-filter-control><a href="#">All</a></li>
                        {% for type in types %}
                            <li uk-filter-control="filter: [data-type='{{type}}']; group: data-type"><a href="#"> {{type}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column">Publication Year</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li class="uk-active" uk-filter-control><a href="#">All</a></li>
                        {% for year in range(now.year, 1984, -1) %}
                            <li uk-filter-control="filter: [data-year='{{year}}']; group: data-year"><a href="#"> {{year}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Alphabetically</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li class="uk-active" uk-filter-control><a href="#">All</a></li>
                        {% for char in "ABCDEFGHIJKLMNOPQRSTUVWXYZ"|list %}
                            <li class="uk-padding-remove uk-margin-small-left" uk-filter-control="filter: [data-name='{{char}}']; group: data-name"><a href="#"> {{char}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            
            <ul class="js-filter uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-2 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                {% for pub in publications %}
                    <li data-year="{{pub['publication_date'].strftime('%Y')}}" data-type="{{pub['pub_type']}}" data-name="{{pub['title'][0]|capitalize}}" style="padding: 0 30px; transform: translateY(0px); display: none;" class="uk-margin-medium-top">
                        <div style="cursor: pointer;" onclick="window.location=`/publication/{{pub['id']}}`" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                            <div style="height: 140px; width: 100px;" class="uk-background-contain" data-src="{% if not pub['cover'] %} /static/images/publications/{{pub['pub_type']}}.png {% else %} {{pub['cover']}} {% endif %}" uk-img></div>
                            <div class="uk-margin-small-left uk-width-expand">
                                <h4 class="uk-margin-remove"> {{pub['title']|title}} </h4>
                                <div class="uk-text-middle uk-margin-small-bottom"><span class="uk-label"> {{pub['pub_type']}} </span> {% if pub['publication_date'].strftime('%Y') != '1' %} {{pub['publication_date'].strftime('%Y')}} {% endif %} </div>
                                <div>
                                    {% if pub['pub_records'].all()|length < 3 %}
                                        {% for n in range(pub['pub_records'].all()|length) %}
                                            <a href="/profile/{{pub['pub_records'][n].researcher.id}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('{% if pub['pub_records'][n].researcher.image_url %} {{pub['pub_records'][n].researcher.image_url}} {% else %} /static/images/unknown.png {% endif %} ');" uk-icon></span> {{pub['pub_records'][n].researcher.first_name}}  {{pub['pub_records'][n].researcher.last_name}} </a>                              
                                        {% endfor %}

                                        {% if pub['coauthors'] != "" and pub['coauthors'] %}
                                            {% set coauthors = pub['coauthors'].split(', ') %}
                                        {% endif %}

                                        {% set limit = 3 - pub['pub_records'].all()|length %}
                                        {% if limit < coauthors|length %}
                                            {% for n in range(limit) %}
                                                <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                            {% endfor %}
                                            {% if coauthors|length - limit > 0 %} +{{coauthors|length - limit}} More {% endif %}
                                        {% else %}    
                                            {% for n in range(coauthors|length) %}
                                                <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                            {% endfor %}                              
                                        {% endif %}
                                    {% else %}
                                        {% for n in range(3) %}
                                            <a href="/profile/{{pub['pub_records'][n].researcher.id}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url(`{% if pub['pub_records'][n].researcher.image_url %} {{pub['pub_records'][n].researcher.image_url}} {% else %} /static/images/unknown.png {% endif %} `);" uk-icon></span> {{pub['pub_records'][n].researcher.first_name}}  {{pub['pub_records'][n].researcher.last_name}} </a>                              
                                        {% endfor %}
                                        {% if pub['pub_records'].all()|length > 3 %} +{{test|length - 3}} More {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}

{% endautoescape %}
{% endblock %}
