{% extends "layout.html" %}
{% block title %}MyeSearch Results{% endblock %}
{% block page %}MyeSearch Results{% endblock %}

{{ super() }}

{% block content %}
{% autoescape off %}

    {% if topic_page %}
        <div style="min-height: 30vh;" class="uk-background-muted uk-padding">
            <h3 class="uk-margin-small-bottom uk-text-bold">{{topic_.name}}</h3>

            {% if topic_.subtopics|length %}
                <h4 class="uk-margin-small-bottom">Subtopics</h4>
                <hr>
                <div style="overflow-x: scroll; white-space: nowrap;" class="uk-flex">
                    {% for top in topic_.subtopics %}
                        <a href="/topic/{{top.id}}" style="padding: 0 10px;" class="uk-text-capitalize uk-margin-small-right uk-button uk-button-default uk-background-default uk-border-pill"> {{top.name}} </a>
                    {% endfor %}
                </div>
            {% endif %}

            {% if not topic_.researcher_tags.all()|length and not topic_pubs|length %}
                <div class="uk-margin-medium-top uk-width-1-1 uk-flex uk-flex-center uk-flex-middle uk-flex-column uk-flex-stretch uk-text-center">
                    <img src="https://img.icons8.com/ios-filled/100/null/empty-box.png"/>
                    Nothing Added Yet
                </div>
            {% endif %}

            {% if topic_.researcher_tags.all()|length %}
                <h4 class="uk-margin-small-bottom">Researchers</h4>
                <hr>
                <ul class="uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-4 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                    {% for tag in topic_.researcher_tags %}
                        <li style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                            <div style="cursor: pointer;" onclick="window.location='/profile/{{tag.researcher.id}}'" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                <div class="uk-margin-small-top uk-margin-small-bottom uk-width-1-1 uk-text-center">
                                    <div class="uk-flex uk-flex-center uk-margin-small-bottom">
                                        <div class="uk-border-circle uk-background-cover" data-src="{% if tag.researcher.image_url %} {{tag.researcher.image_url}} {% else %} /static/images/unknown.png {% endif %}" alt="" style="width: 200px; height: 200px;" uk-img></div>
                                    </div>
                                    <h4 class="uk-margin-auto"> {{tag.researcher.title}} {{tag.researcher.first_name}} {{tag.researcher.last_name}} </h4>
                                    <div> {{tag.researcher.position}} </div>
                                    <div> {{tag.researcher.faculty}} </div>
                                    <div> {{tag.researcher.department}} </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if topic_pubs|length %}
                <h4 class="uk-margin-small-bottom">Publications</h4>
                <hr>
                <ul class="uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-2 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                    {% for pub in topic_pubs %}
                        <li style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                            <div style="cursor: pointer;" onclick="window.location=`/publication/{{pub['id']}}`" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                <div style="height: 140px; width: 100px;" class="uk-background-contain" data-src="/static/images/publications/{{pub['pub_type']}}.png" uk-img></div>
                                <div class="uk-margin-small-left uk-width-expand">
                                    <h4 class="uk-margin-remove"> {{pub['title']|title}} </h4>
                                    <div class="uk-text-middle uk-margin-small-bottom"><span class="uk-label"> {{pub['pub_type']}} </span> {% if pub['publication_date'] != '1' %} {{pub['publication_date']}} {% endif %} </div>
                                    <div>
                                        {% set coauthors = [] %}
                                        {% if pub['coauthors'] != "" and pub['coauthors'] %}
                                            {% set coauthors = pub['coauthors'].split(', ') %}
                                        {% endif %}
                                        {% if pub['authors']|length < 3 %}
                                            {% for n in range(pub['authors']|length) %}
                                                <a href="/profile/{{pub['authors'][n]['id']}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('{% if pub['authors'][n]['image_url'] %} {{pub['authors'][n]['image_url']}} {% else %} /static/images/unknown.png {% endif %} ');" uk-icon></span> {{pub['authors'][n]['first_name']}}  {{pub['authors'][n]['last_name']}} </a>                              
                                            {% endfor %}

                                            {% set limit = 3 - pub['authors']|length %}
                                            {% if limit < coauthors|length %}
                                                {% for n in range(limit) %}
                                                    <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                                {% endfor %}
                                                {% if coauthors|length - limit > 0 %} +{{coauthors|length - limit}} More {% endif %}
                                            {% else %}    
                                                {% for n in range(coauthors|length) %}
                                                    <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                                {% endfor %}                              
                                            {% endif %}
                                        {% else %}
                                            {% for n in range(3) %}
                                                <a href="/profile/{{pub['authors'][n]['id']}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url(`{% if pub['authors'][n]['image_url'] %} {{pub['authors'][n]['image_url']}} {% else %} /static/images/unknown.png {% endif %} `);" uk-icon></span> {{pub['authors'][n]['first_name']}}  {{pub['authors'][n]['last_name']}} </a>                              
                                            {% endfor %}
                                            {% if pub['authors']|length > 3 %} +{{(pub['authors']|length + coauthors|length ) - 3}} More {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

        </div>
    {% endif %}

    {% if search %}
        <div style="min-height: 30vh;" class="uk-background-muted uk-padding">
            <h3 class="uk-margin-small-bottom uk-text-bold">Search Results For "{{search_terms}}"</h3>

            {% if not results[0] and not results[1] and not results[2] %}
                No Results Found
            {% endif %}

            <!-- topics -->
            {% if results[2] %}
                <h4 class="uk-margin-small-bottom">Topics</h4>
                <hr>
                <div style="overflow-x: scroll; white-space: nowrap;" class="uk-flex">
                    {% for top in results[2] %}
                        <a href="/topic/{{top.id}}" style="padding: 0 10px;" class="uk-text-capitalize uk-margin-small-right uk-button uk-button-default uk-background-default uk-border-pill"> {{top.name}} </a>
                    {% endfor %}
                </div>  
            {% endif %}
            
            <!-- authors -->
            {% if results[0] %}
                <h4 class="uk-margin-small-bottom">Researchers</h4>
                <hr>
                <ul class="uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-4 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                    {% for re in results[0] %}
                        <li onclick="addSearchResearcher({{re.id}});" data-name="{{re.first_name[0]|capitalize}}" data-faculty="{{re.faculty}}" data-department="{{re.department}}" style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                            <div style="cursor: pointer;" onclick="window.location='/profile/{{re.id}}'" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                <div class="uk-margin-small-top uk-margin-small-bottom uk-width-1-1 uk-text-center">
                                    <div class="uk-flex uk-flex-center uk-margin-small-bottom">
                                        <div class="uk-border-circle uk-background-cover" data-src="{% if re.image_url %} {{re.image_url}} {% else %} /static/images/unknown.png {% endif %}" alt="" style="width: 200px; height: 200px;" uk-img></div>
                                    </div>
                                    <h4 class="uk-margin-auto"> {{re.title}} {{re.first_name}} {{re.last_name}} </h4>
                                    <div> {{re.position}} </div>
                                    <div> {{re.faculty}} </div>
                                    <div> {{re.department}} </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            <!-- publications -->
            {% if results[1] %}
                <h4 class="uk-margin-small-bottom">Publications</h4>
                <hr>
                <ul id="search_pubs" class="uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-2 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card">
                    {% for pub in results[1] %}
                        <li onclick="addSearchPublication({{pub.id}});" data-year="{{pub['publication_date']}}" data-type="{{pub['pub_type']}}" data-name="{{pub['title'][0]|capitalize}}" style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                            <div style="cursor: pointer;" onclick="window.location=`/publication/{{pub['id']}}`" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                <div style="height: 140px; width: 100px;" class="uk-background-contain" data-src="/static/images/publications/{{pub['pub_type']}}.png" uk-img></div>
                                <div class="uk-margin-small-left uk-width-expand">
                                    <h4 class="uk-margin-remove"> {{pub['title']|title}} </h4>
                                    <div class="uk-text-middle uk-margin-small-bottom"><span class="uk-label"> {{pub['pub_type']}} </span> {% if pub['publication_date'] != '1' %} {{pub['publication_date']}} {% endif %} </div>
                                    <div>
                                        {% set coauthors = [] %}
                                        {% if pub['coauthors'] != "" and pub['coauthors'] %}
                                            {% set coauthors = pub['coauthors'].split(', ') %}
                                        {% endif %}
                                        {% if pub['authors']|length < 3 %}
                                            {% for re in pub['authors'] %}
                                                <a href="/profile/{{re['id']}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('{% if re['image_url'] %} {{re['image_url']}} {% else %} /static/images/unknown.png {% endif %} ');" uk-icon></span> {{re['first_name']}}  {{re['last_name']}} </a>                              
                                            {% endfor %}

                                            {% set limit = 3 - pub['authors']|length %}
                                            {% if limit < coauthors|length %}
                                                {% for n in range(limit) %}
                                                    <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                                {% endfor %}
                                                {% if coauthors|length - limit > 0 %} +{{coauthors|length - limit}} More {% endif %}
                                            {% else %}    
                                                {% for n in range(coauthors|length) %}
                                                    <a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22{{coauthors[n]}}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> {{coauthors[n]}} </a>
                                                {% endfor %}                              
                                            {% endif %}
                                        {% else %}
                                            {% for n in range(3) %}
                                                <a href="/profile/{{pub['authors'][n]['id']}}" style="padding: 2px 3px; height: 45px;" class="uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url(`{% if pub['authors'][n]['image_url'] %} {{pub['authors'][n]['image_url']}} {% else %} /static/images/unknown.png {% endif %} `);" uk-icon></span> {{pub['authors'][n]['first_name']}}  {{pub['authors'][n]['last_name']}} </a>                              
                                            {% endfor %}
                                            {% if pub['authors']|length > 3 %} +{{(pub['authors']|length + coauthors|length) - 3}} More {% endif %}
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
                <script>                </script>
            {% endif %}
        </div>
    {% endif %}

    {% if researchers %}
        <div class="uk-background-muted uk-width-1-1" uk-filter="target: .js-filter;">
            <h3 id="researcher_num" class="uk-text-bold uk-padding uk-padding-remove-bottom"></h3>
                        
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Faculty</h4>
                <div>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li onclick="get_selection(this)" class="uk-active" uk-filter-control><a href="">All</a></li>
                        {% for faculty in faculties %}
                            <li onclick="get_selection(this)" uk-filter-control="filter: [data-faculty='{{faculty}}']; group: data-faculty"><a href="#"> {{faculty}} </a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div style="display: none;" id="department_section" class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Department</h4>
                <div>
                    <ul id="department_listing" class="uk-subnav uk-subnav-pill" uk-margin></ul>
                </div>
            </div>
        
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Alphabetically</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li onclick="get_selection(this)" class="uk-active" uk-filter-control><a href="">All</a></li>
                        {% for char in "ABCDEFGHIJKLMNOPQRSTUVWXYZ"|list %}
                            <li class="uk-padding-remove uk-margin-small-left" uk-filter-control="filter: [data-name='{{char}}']; group: data-name"><a href="#"> {{char}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            
            <ul id="all_researcher_ul" class="js-filter uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-4 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card"></ul>
            <script>
                let ar_ul = document.getElementById('all_researcher_ul');
                let re_num = document.getElementById('researcher_num');
                async function loadResearchers(){
                    let response = await fetch("/load/reasearchers");
                    let researchers = await response.json();
                    re_num.innerHTML = `All Researchers (${researchers.length} Present)`;
                    let html1 = "";
                    for (let x = 0; x < researchers.length; x += 1){
                        window.setTimeout(() => {
                            let re = researchers[x];
                            html1 += `
                                <li data-name="${re['first_name'][0].toUpperCase()}" data-faculty="${re['faculty']}" data-department="${re['department']}" style="padding: 0 30px; transform: translateY(0px);" class="uk-margin-medium-top">
                                    <div style="cursor: pointer;" onclick="window.location='/profile/${re['id']}'" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                        <div class="uk-margin-small-top uk-margin-small-bottom uk-width-1-1 uk-text-center">
                                            <div class="uk-flex uk-flex-center uk-margin-small-bottom">`;
                                                let html2 = "";
                                                if (re['image_url'] != null){
                                                    html2 = `<div class="uk-border-circle uk-background-cover" data-src="${re['image_url']}" alt="" style="width: 200px; height: 200px;" uk-img></div>`; 
                                                }
                                                else{
                                                    html2 = `<div class="uk-border-circle uk-background-cover" data-src="/static/images/unknown.png" alt="" style="width: 200px; height: 200px;" uk-img></div>`; 
                                                }
                                                html1 += html2;
                                                html1 += `
                                            </div>
                                            <h4 class="uk-margin-auto"> ${re['title']} ${re['first_name']} ${re['last_name']} </h4>
                                            <div> ${re['position']} </div>
                                            <div> ${re['faculty']} </div>
                                            <div> ${re['department']} </div>
                                        </div>
                                    </div>
                                </li>
                            `;
                            if (x % (researchers.length - 1) == 0){
                                ar_ul.innerHTML = html1;
                            }
                        }, 0);
                    } 
                }
                loadResearchers();
            </script>
        </div>
    {% endif %}

    {% if publications %}
        <div class="uk-background-muted uk-width-1-1" uk-filter="target: .js-filter;">
            <h3 id="publication_num" class="uk-text-bold uk-padding uk-padding-remove-bottom"></h3>

            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column">Publication Type</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li class="uk-active" uk-filter-control><a href="">All</a></li>
                        {% for type in types %}
                            <li uk-filter-control="filter: [data-type='{{type}}']; group: data-type"><a href="#"> {{type}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column">Publication Year</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li class="uk-active" uk-filter-control><a href="">All</a></li>
                        {% for year in range(now.year, 1984, -1) %}
                            <li uk-filter-control="filter: [data-year='{{year}}']; group: data-year"><a href="#"> {{year}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            <div class="uk-grid uk-grid-small uk-grid-divider uk-child-width-auto uk-padding uk-padding-remove-vertical" uk-grid>
                <h4 class="uk-first-column uk-width-1-1">Alphabetically</h4>
                <span>
                    <ul class="uk-subnav uk-subnav-pill" uk-margin>
                        <li class="uk-active" uk-filter-control><a href="">All</a></li>
                        {% for char in "ABCDEFGHIJKLMNOPQRSTUVWXYZ"|list %}
                            <li class="uk-padding-remove uk-margin-small-left" uk-filter-control="filter: [data-name='{{char}}']; group: data-name"><a href="#"> {{char}} </a></li>
                        {% endfor %}
                    </ul>
                </span>
            </div>
            
            <ul id="all_publication_ul" class="js-filter uk-grid uk-margin-remove-top uk-margin-remove-left uk-child-width-1-2 scroll uk-padding uk-padding-remove-horizontal uk-padding-remove-top" uk-grid uk-height-match="target: .uk-card"></ul>
            <script>                
                let ol = document.getElementById('overlay');

                let ap_ul = document.getElementById('all_publication_ul');
                let pub_num = document.getElementById('publication_num');

                async function loadPublications(){
                    let response = await fetch('/load/publications');
                    let publications = await response.json();
                    pub_num.innerHTML = `All Publications (${publications.length} Present)`;
                    let html1 = "";
                    for (let x = 0; x < publications.length; x += 1){
                        let pub = publications[x];
                        window.setTimeout(() => {
                            html1 += `
                                <li data-year="${pub['publication_date']}" data-type="${pub['pub_type']}" data-name="${pub['title'][0].toUpperCase()}" style="padding: 0 30px; transform: translateY(0px); display: none;" class="uk-margin-medium-top">
                                    <div style="cursor: pointer;" onclick="window.location='/publication/${pub['id']}'" class="uk-card uk-card-default uk-padding-small uk-flex uk-inline hvr-grow-shadow uk-height-1-1">
                                        <div style="height: 140px; width: 100px;" class="uk-background-contain" data-src="/static/images/publications/${pub['pub_type']}.png" uk-img></div>
                                        <div class="uk-margin-small-left uk-width-expand">
                                            <h4 class="uk-margin-remove"> ${titleCase(pub['title'])} </h4>
                                            <div class="uk-text-middle uk-margin-small-bottom"><span class="uk-label uk-margin-small-right"> ${pub['pub_type']} </span>`;
                                                if (pub['publication_date'] != 1){
                                                    html1 += `${pub['publication_date']}`;
                                                }
                                                html1 += `</div>
                                            <div>`;
                                                let coauthors = [];
                                                if (pub['authors'].length < 3){
                                                    for (let re of pub['authors']){
                                                        html1 += `<a href="/profile/${re['id']}" style="padding: 2px 3px; height: 45px;" class="uk-margin-small-right uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('`;
                                                            if (re['image_url'] != null){
                                                                html1 += `${re['image_url']}`;
                                                            } 
                                                            else {
                                                                html1 += '/static/images/unknown.png';
                                                            }   
                                                        html1 += `');" uk-icon></span> ${re['first_name']}  ${re['last_name']} </a>`;
                                                    }
                                                    if (pub['coauthors'] != "" && pub['coauthors'] != null){
                                                        coauthors = pub['coauthors'].split(', ');
                                                        let limit = 3 - pub['authors'].length;
                                                        if (limit < coauthors.length){
                                                            for (let n = 0; n < limit; n += 1){
                                                                html1 += `<a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22${coauthors[n]}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-margin-small-right uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> ${coauthors[n]} </a>`;
                                                            }
                                                            html1 += `+${coauthors.length - limit} More`;
                                                        }
                                                        else {
                                                            for (let n = 0; n < coauthors.length; n += 1){
                                                                html1 += `<a href="https://scholar.google.com/scholar?as_vis=1&q=author:+%22${coauthors[n]}%22&hl=en&as_sdt=0,5" style="padding: 2px 3px; height: 45px;" class="uk-margin-small-right uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('/static/images/unknown.png');" uk-icon></span> ${coauthors[n]} </a>`;
                                                            }
                                                        }
                                                    }
                                                }
                                                else{
                                                    for (let n = 0; n < 3; n += 1){
                                                        html1 += `<a href="/profile/${pub['authors'][n]['id']}" style="padding: 2px 3px; height: 45px;" class="uk-margin-small-right uk-border-pill uk-background-muted uk-inline uk-text-decoration-none uk-button uk-button-default uk-text-capitalize"><span class="uk-icon uk-icon-image uk-border-circle" style="height: 30px; width: 30px; background-image: url('`;
                                                            if (pub['authors'][n]['image_url'] != null){
                                                                html1 += `${pub['authors'][n]['image_url']}`;
                                                            } 
                                                            else {
                                                                html1 += '/static/images/unknown.png';
                                                            }   
                                                        html1 += `');" uk-icon></span> ${pub['authors'][n]['first_name']}  ${pub['authors'][n]['last_name']} </a>`;
                                                    }
                                                    if (pub['authors'].length > 3){
                                                        html1 += `+${(pub['authors'].length + coauthors.length) - 3} More`;
                                                    }
                                                }
                                            html1 += `</div>
                                        </div>
                                    </div>
                                </li>
                            `;
                            if (x % (publications.length - 1) == 0){
                                ap_ul.innerHTML = html1;
                            }
                        }, 0); 
                    } 
                    ol.style.opacity = '0';
                    this.document.body.style.overflowY = 'auto';
                    this.setTimeout(function(){
                        ol.style.visibility = 'hidden';
                        ol.style.display = 'none';
                    }, 200);
                }

                function titleCase(str) {
                    return str.toLowerCase().replace(/\b\w/g, s => s.toUpperCase());
                }
                loadPublications();
            </script>
        </div>
    {% endif %}

{% endautoescape %}
{% endblock %}
